<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat & Transcription - Groq, OpenAI, x.ai & Anthropic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        .chat-container {
            height: calc(100vh - 180px);
        }
        .message {
            max-width: 80%;
        }
        .sidebar {
            height: calc(100vh - 60px);
        }
        .bookmark-active {
            color: #f59e0b;
        }
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #6b7280;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }
        .dark-mode {
            background-color: #1f2937;
            color: #f9fafb;
        }
        .dark-mode .bg-white {
            background-color: #374151;
        }
        .dark-mode .bg-gray-50 {
            background-color: #1f2937;
        }
        .dark-mode .text-gray-700 {
            color: #d1d5db;
        }
        .dark-mode .text-gray-600 {
            color: #9ca3af;
        }
        .dark-mode .border-gray-300 {
            border-color: #4b5563;
        }
        .dark-mode .hover\:bg-gray-100:hover {
            background-color: #4b5563;
        }
        .provider-tab {
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .provider-tab.active {
            border-bottom: 3px solid #4f46e5;
            color: #4f46e5;
        }
        .model-badge {
            font-size: 0.65rem;
            padding: 0.1rem 0.4rem;
            border-radius: 0.25rem;
            font-weight: 600;
        }
        .badge-new {
            background-color: #10b981;
            color: white;
        }
        .badge-updated {
            background-color: #3b82f6;
            color: white;
        }
        .badge-preview {
            background-color: #f59e0b;
            color: white;
        }
        .badge-production {
            background-color: #8b5cf6;
            color: white;
        }
        .message-content {
            line-height: 1.6;
        }
        .message-content p {
            margin-bottom: 0.75rem;
        }
        .message-content p:last-child {
            margin-bottom: 0;
        }
        .message-content pre {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            margin: 0.75rem 0;
            position: relative;
        }
        .message-content pre code {
            background: none;
            padding: 0;
            color: inherit;
            font-size: 0.875rem;
        }
        .message-content code {
            background-color: #edf2f7;
            color: #2d3748;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }
        .dark-mode .message-content code {
            background-color: #4a5568;
            color: #e2e8f0;
        }
        .message-content ul, .message-content ol {
            margin: 0.75rem 0;
            padding-left: 1.5rem;
        }
        .message-content li {
            margin-bottom: 0.25rem;
        }
        .message-content blockquote {
            border-left: 4px solid #4f46e5;
            padding-left: 1rem;
            margin: 0.75rem 0;
            color: #6b7280;
            font-style: italic;
        }
        .message-content h1, .message-content h2, .message-content h3 {
            margin: 1rem 0 0.5rem 0;
            font-weight: 600;
        }
        .message-content h1 {
            font-size: 1.5rem;
        }
        .message-content h2 {
            font-size: 1.25rem;
        }
        .message-content h3 {
            font-size: 1.125rem;
        }
        .message-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.75rem 0;
        }
        .message-content th, .message-content td {
            border: 1px solid #e5e7eb;
            padding: 0.5rem;
            text-align: left;
        }
        .message-content th {
            background-color: #f9fafb;
            font-weight: 600;
        }
        .dark-mode .message-content th {
            background-color: #374151;
            border-color: #4b5563;
        }
        .dark-mode .message-content td {
            border-color: #4b5563;
        }
        .copy-button {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #4f46e5;
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .copy-button:hover {
            background-color: #4338ca;
        }
        .copy-button.copied {
            background-color: #10b981;
        }
        .message-content a {
            color: #4f46e5;
            text-decoration: underline;
        }
        .message-content a:hover {
            color: #4338ca;
        }
        .provider-tabs {
            overflow-x: auto;
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f3f4f6;
        }
        .provider-tabs::-webkit-scrollbar {
            height: 4px;
        }
        .provider-tabs::-webkit-scrollbar-track {
            background: #f3f4f6;
        }
        .provider-tabs::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }
        .web-search-results {
            background-color: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 0.75rem 0;
        }
        .dark-mode .web-search-results {
            background-color: #1e3a5f;
            border-color: #0284c7;
        }
        .web-search-title {
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        .dark-mode .web-search-title {
            color: #0ea5e9;
        }
        .web-search-result {
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #e0f2fe;
        }
        .web-search-result:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .web-search-result-title {
            font-weight: 600;
            color: #0c4a6e;
            margin-bottom: 0.25rem;
        }
        .dark-mode .web-search-result-title {
            color: #7dd3fc;
        }
        .web-search-result-snippet {
            color: #075985;
            font-size: 0.875rem;
        }
        .dark-mode .web-search-result-snippet {
            color: #bae6fd;
        }
        .web-search-result-link {
            color: #0369a1;
            font-size: 0.75rem;
            text-decoration: none;
        }
        .dark-mode .web-search-result-link {
            color: #0ea5e9;
        }
        .web-search-result-link:hover {
            text-decoration: underline;
        }
        /* Transcription Styles */
        .transcription-container {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 0.75rem 0;
        }
        .dark-mode .transcription-container {
            background-color: #374151;
            border-color: #4b5563;
        }
        .transcription-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .transcription-title {
            font-weight: 600;
            color: #4f46e5;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .dark-mode .transcription-title {
            color: #818cf8;
        }
        .transcription-text {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            padding: 0.75rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        .dark-mode .transcription-text {
            background: #1f2937;
            border-color: #4b5563;
            color: #f3f4f6;
        }
        .transcription-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            align-items: center;
        }
        .transcription-info {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.5rem;
        }
        .dark-mode .transcription-info {
            color: #9ca3af;
        }
        .transcription-progress {
            margin-top: 0.75rem;
        }
        .progress-bar {
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
        }
        .dark-mode .progress-bar {
            background-color: #4b5563;
        }
        .progress-fill {
            height: 100%;
            background-color: #4f46e5;
            width: 0%;
            transition: width 0.3s ease;
        }
        .progress-text {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
            text-align: right;
        }
        .dark-mode .progress-text {
            color: #9ca3af;
        }
        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #f9fafb;
        }
        .dark-mode .file-upload-area {
            border-color: #4b5563;
            background-color: #1f2937;
        }
        .file-upload-area:hover {
            border-color: #4f46e5;
            background-color: #f0f9ff;
        }
        .dark-mode .file-upload-area:hover {
            border-color: #818cf8;
            background-color: #1e3a5f;
        }
        .file-upload-area.dragover {
            border-color: #4f46e5;
            background-color: #dbeafe;
        }
        .dark-mode .file-upload-area.dragover {
            border-color: #818cf8;
            background-color: #1e3a5f;
        }
        .file-list {
            margin-top: 1rem;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
            background-color: white;
        }
        .dark-mode .file-item {
            border-color: #4b5563;
            background-color: #374151;
        }
        .file-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            overflow: hidden;
        }
        .file-name {
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        .file-size {
            font-size: 0.75rem;
            color: #6b7280;
        }
        .dark-mode .file-size {
            color: #9ca3af;
        }
        .file-actions {
            display: flex;
            gap: 0.5rem;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .transcription-options {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .option-group {
            flex: 1;
            min-width: 200px;
        }
        .option-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.25rem;
            color: #4b5563;
        }
        .dark-mode .option-label {
            color: #d1d5db;
        }
        .option-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: white;
            font-size: 0.875rem;
        }
        .dark-mode .option-select {
            border-color: #4b5563;
            background-color: #1f2937;
            color: #f3f4f6;
        }
        .option-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .notification.success {
            background-color: #10b981;
        }
        .notification.error {
            background-color: #ef4444;
        }
        .notification.info {
            background-color: #3b82f6;
        }
        .btn {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn:hover {
            transform: translateY(-1px);
        }
        .btn:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        .btn:disabled:hover {
            transform: none;
        }
        /* Added for better button feedback */
        .btn:active {
            transform: translateY(1px);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <div class="flex flex-col h-screen">
        <!-- Header -->
        <header class="bg-indigo-700 text-white p-4 shadow-md">
            <div class="container mx-auto flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-brain text-2xl"></i>
                    <h1 class="text-xl font-bold">Multi-LLM Front-End</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="settings-btn" class="p-2 rounded-full hover:bg-indigo-600 transition">
                        <i class="fas fa-cog"></i>
                    </button>
                    <button id="dark-mode-toggle" class="p-2 rounded-full hover:bg-indigo-600 transition">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
            </div>
        </header>
        <div class="flex flex-1 overflow-hidden">
            <!-- Sidebar -->
            <aside class="w-64 bg-white border-r border-gray-200 sidebar flex flex-col">
                <div class="p-4 border-b border-gray-200">
                    <button id="new-chat-btn" class="w-full py-2 px-4 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition flex items-center justify-center btn">
                        <i class="fas fa-plus mr-2"></i> New Chat
                    </button>
                </div>
                
                <div class="flex-1 overflow-y-auto p-2">
                    <div class="mb-4">
                        <h3 class="text-sm font-semibold text-gray-500 uppercase px-2 mb-2">Bookmarked</h3>
                        <div id="bookmarked-chats" class="space-y-1">
                            <!-- Bookmarked chats will be added here -->
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase px-2 mb-2">Recent Chats</h3>
                        <div id="recent-chats" class="space-y-1">
                            <!-- Recent chats will be added here -->
                        </div>
                    </div>
                </div>
                
                <div class="p-4 border-t border-gray-200 text-center text-sm text-gray-500">
                    <div>Provider: <span id="current-provider">Not Set</span></div>
                    <div>API Key: <span id="api-key-status">Not Set</span></div>
                </div>
            </aside>
            <!-- Main Content -->
            <main class="flex-1 flex flex-col">
                <!-- Provider Selection -->
                <div class="bg-white border-b border-gray-200">
                    <div class="container mx-auto provider-tabs">
                        <button id="groq-tab" class="provider-tab px-6 py-3 font-medium text-gray-600 hover:text-indigo-700 active">
                            <i class="fas fa-bolt mr-2"></i> Groq
                        </button>
                        <button id="openai-tab" class="provider-tab px-6 py-3 font-medium text-gray-600 hover:text-indigo-700">
                            <i class="fas fa-robot mr-2"></i> OpenAI
                        </button>
                        <button id="xai-tab" class="provider-tab px-6 py-3 font-medium text-gray-600 hover:text-indigo-700">
                            <i class="fas fa-rocket mr-2"></i> x.ai
                        </button>
                        <button id="anthropic-tab" class="provider-tab px-6 py-3 font-medium text-gray-600 hover:text-indigo-700">
                            <i class="fas fa-feather mr-2"></i> Anthropic
                        </button>
                        <button id="transcription-tab" class="provider-tab px-6 py-3 font-medium text-gray-600 hover:text-indigo-700">
                            <i class="fas fa-microphone-alt mr-2"></i> Transcription
                        </button>
                    </div>
                </div>
                <!-- Model Selection -->
                <div id="chat-model-selection" class="bg-white border-b border-gray-200 p-3 tab-content active">
                    <div class="container mx-auto flex flex-wrap items-center justify-between gap-3">
                        <div class="flex items-center space-x-3">
                            <label for="model-select" class="text-sm font-medium text-gray-700">Model:</label>
                            <select id="model-select" class="border border-gray-300 rounded-md px-3 py-1 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <!-- Models will be populated based on provider -->
                            </select>
                            <div id="model-info" class="text-xs text-gray-500"></div>
                        </div>
                        
                        <div class="flex items-center space-x-3">
                            <div class="flex items-center">
                                <input type="checkbox" id="web-search-toggle" class="mr-2 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                <label for="web-search-toggle" class="text-sm text-gray-700">Enable Web Search</label>
                            </div>
                            <button id="clear-chat-btn" class="text-sm text-gray-600 hover:text-gray-900 btn">
                                <i class="fas fa-trash-alt mr-1"></i> Clear Chat
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Transcription Options -->
                <div id="transcription-options-panel" class="bg-white border-b border-gray-200 p-3 tab-content">
                    <div class="container mx-auto">
                        <div class="transcription-options">
                            <div class="option-group">
                                <label class="option-label">Language</label>
                                <select id="transcription-language" class="option-select">
                                    <option value="auto">Auto-detect</option>
                                    <option value="en">English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="zh">Chinese</option>
                                    <option value="ja">Japanese</option>
                                    <option value="ru">Russian</option>
                                    <option value="pt">Portuguese</option>
                                    <option value="it">Italian</option>
                                    <option value="nl">Dutch</option>
                                </select>
                            </div>
                            <div class="option-group">
                                <label class="option-label">Model</label>
                                <select id="transcription-model" class="option-select">
                                    <option value="whisper-large-v3-turbo">Whisper Large v3 Turbo (Faster)</option>
                                    <option value="whisper-large-v3">Whisper Large v3 (Higher Accuracy)</option>
                                </select>
                            </div>
                        </div>
                        <div class="transcription-options">
                            <div class="option-group">
                                <div class="option-checkbox">
                                    <input type="checkbox" id="timestamps" checked>
                                    <label for="timestamps">Include Timestamps</label>
                                </div>
                                <div class="option-checkbox">
                                    <input type="checkbox" id="batch-download">
                                    <label for="batch-download">Download All as ZIP</label>
                                </div>
                            </div>
                            <div class="option-group">
                                <div class="option-checkbox">
                                    <input type="checkbox" id="add-to-chat">
                                    <label for="add-to-chat">Add Transcription to Chat</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Chat Container -->
                <div id="chat-container" class="flex-1 overflow-y-auto p-4 chat-container bg-gray-50 tab-content active">
                    <div id="chat-messages" class="space-y-4 max-w-3xl mx-auto">
                        <!-- Welcome message -->
                        <div class="text-center py-10">
                            <i class="fas fa-robot text-5xl text-indigo-500 mb-4"></i>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">Welcome to AI Chat</h2>
                            <p class="text-gray-600">Start a conversation with the latest AI models from Groq, OpenAI, x.ai, and Anthropic. Select a provider and model to begin!</p>
                        </div>
                    </div>
                </div>
                <!-- Transcription Container -->
                <div id="transcription-container" class="flex-1 overflow-y-auto p-4 chat-container bg-gray-50 tab-content">
                    <div class="max-w-3xl mx-auto">
                        <div class="text-center py-10">
                            <i class="fas fa-microphone-alt text-5xl text-indigo-500 mb-4"></i>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">Audio Transcription</h2>
                            <p class="text-gray-600">Upload audio or video files to transcribe them using Groq's Whisper models.</p>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                            <div class="file-upload-area" id="file-upload-area">
                                <i class="fas fa-cloud-upload-alt text-3xl text-indigo-500 mb-3"></i>
                                <h3 class="text-lg font-medium text-gray-800 mb-2">Drag & Drop your files here</h3>
                                <p class="text-gray-600 mb-1">or click to browse</p>
                                <p class="text-sm text-gray-500">Supports MP3, WAV, M4A, MP4, MOV, etc. Multiple files allowed.</p>
                            </div>
                            <input type="file" id="file-input" class="hidden" accept="audio/*,video/*" multiple>
                            
                            <div class="file-list" id="file-list"></div>
                            
                            <div class="flex flex-wrap gap-3 mt-4">
                                <button id="transcribe-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition btn disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                                    <i class="fas fa-magic mr-2"></i> Transcribe Files
                                </button>
                                <button id="clear-files-btn" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition btn" style="display: none;">
                                    <i class="fas fa-trash mr-2"></i> Clear All
                                </button>
                            </div>
                        </div>
                        
                        <div id="transcription-results" class="space-y-4"></div>
                    </div>
                </div>
                <!-- Input Area -->
                <div id="chat-input-area" class="bg-white border-t border-gray-200 p-4 tab-content active">
                    <div class="container mx-auto max-w-3xl">
                        <div class="flex items-end space-x-2">
                            <div class="flex-1">
                                <textarea id="message-input" class="w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none" rows="2" placeholder="Type your message here..."></textarea>
                            </div>
                            <button id="send-btn" class="bg-indigo-600 text-white rounded-lg px-4 py-3 hover:bg-indigo-700 transition flex items-center justify-center btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="text-xs text-gray-500 mt-2 text-right">
                            Press Enter to send, Shift+Enter for new line
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">Settings</h3>
                <button id="close-settings-btn" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">API Keys</label>
                
                <div class="mb-4">
                    <label for="groq-api-key-input" class="block text-sm font-medium text-gray-700 mb-1">Groq API Key</label>
                    <input type="password" id="groq-api-key-input" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your Groq API key">
                </div>
                
                <div class="mb-4">
                    <label for="openai-api-key-input" class="block text-sm font-medium text-gray-700 mb-1">OpenAI API Key</label>
                    <input type="password" id="openai-api-key-input" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your OpenAI API key">
                </div>
                
                <div class="mb-4">
                    <label for="xai-api-key-input" class="block text-sm font-medium text-gray-700 mb-1">x.ai API Key</label>
                    <input type="password" id="xai-api-key-input" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your x.ai API key">
                </div>
                
                <div class="mb-4">
                    <label for="anthropic-api-key-input" class="block text-sm font-medium text-gray-700 mb-1">Anthropic API Key</label>
                    <input type="password" id="anthropic-api-key-input" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your Anthropic API key">
                </div>
                
                <p class="text-xs text-gray-500 mt-1">Your API keys are stored locally and never sent to any server.</p>
            </div>
            
            <div class="flex justify-end space-x-3">
                <button id="save-settings-btn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition btn">
                    Save
                </button>
            </div>
        </div>
    </div>
    <script>
        // DOM Elements
        const chatMessages = document.getElementById('chat-messages');
        const messageInput = document.getElementById('message-input');
        const sendBtn = document.getElementById('send-btn');
        const newChatBtn = document.getElementById('new-chat-btn');
        const clearChatBtn = document.getElementById('clear-chat-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettingsBtn = document.getElementById('close-settings-btn');
        const saveSettingsBtn = document.getElementById('save-settings-btn');
        const groqApiKeyInput = document.getElementById('groq-api-key-input');
        const openaiApiKeyInput = document.getElementById('openai-api-key-input');
        const xaiApiKeyInput = document.getElementById('xai-api-key-input');
        const anthropicApiKeyInput = document.getElementById('anthropic-api-key-input');
        const apiKeyStatus = document.getElementById('api-key-status');
        const currentProviderSpan = document.getElementById('current-provider');
        const modelSelect = document.getElementById('model-select');
        const modelInfo = document.getElementById('model-info');
        const webSearchToggle = document.getElementById('web-search-toggle');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const bookmarkedChatsContainer = document.getElementById('bookmarked-chats');
        const recentChatsContainer = document.getElementById('recent-chats');
        const groqTab = document.getElementById('groq-tab');
        const openaiTab = document.getElementById('openai-tab');
        const xaiTab = document.getElementById('xai-tab');
        const anthropicTab = document.getElementById('anthropic-tab');
        const transcriptionTab = document.getElementById('transcription-tab');
        
        // Transcription elements
        const fileUploadArea = document.getElementById('file-upload-area');
        const fileInput = document.getElementById('file-input');
        const fileList = document.getElementById('file-list');
        const transcribeBtn = document.getElementById('transcribe-btn');
        const clearFilesBtn = document.getElementById('clear-files-btn');
        const transcriptionResultsContainer = document.getElementById('transcription-results');
        const transcriptionLanguage = document.getElementById('transcription-language');
        const transcriptionModel = document.getElementById('transcription-model');
        const timestampsCheckbox = document.getElementById('timestamps');
        const batchDownloadCheckbox = document.getElementById('batch-download');
        const addToChatCheckbox = document.getElementById('add-to-chat');
        
        // Tab elements
        const chatModelSelection = document.getElementById('chat-model-selection');
        const transcriptionOptionsPanel = document.getElementById('transcription-options-panel');
        const chatContainer = document.getElementById('chat-container');
        const transcriptionContainer = document.getElementById('transcription-container');
        const chatInputArea = document.getElementById('chat-input-area');
        
        // Model lists with latest models as of July 2025
        const groqModels = [
            // Production Models
            { value: 'llama-3.1-8b-instant', label: 'Llama 3.1 8B Instant', context: 131072, maxTokens: 131072, description: 'Meta Llama 3.1 8B production model', badge: 'badge-production', category: 'production' },
            { value: 'llama-3.3-70b-versatile', label: 'Llama 3.3 70B Versatile', context: 131072, maxTokens: 32768, description: 'Meta Llama 3.3 70B production model', badge: 'badge-production', category: 'production' },
            { value: 'meta-llama/llama-guard-4-12b', label: 'Llama Guard 4 12B', context: 131072, maxTokens: 1024, description: 'Meta safety model for content moderation', badge: 'badge-production', category: 'production' },
            { value: 'openai/gpt-oss-120b', label: 'GPT-OSS 120B', context: 131072, maxTokens: 65536, description: 'OpenAI 120B open-source model', badge: 'badge-production', category: 'production' },
            { value: 'openai/gpt-oss-20b', label: 'GPT-OSS 20B', context: 131072, maxTokens: 65536, description: 'OpenAI 20B open-source model', badge: 'badge-production', category: 'production' },
            
            // Preview Models
            { value: 'deepseek-r1-distill-llama-70b', label: 'DeepSeek R1 Distill Llama 70B', context: 131072, maxTokens: 131072, description: 'DeepSeek distilled model based on Llama 70B', badge: 'badge-preview', category: 'preview' },
            { value: 'meta-llama/llama-4-maverick-17b-128e-instruct', label: 'Llama 4 Maverick 17B', context: 131072, maxTokens: 8192, description: 'Meta Llama 4 Maverick with 128 experts', badge: 'badge-preview', category: 'preview' },
            { value: 'meta-llama/llama-4-scout-17b-16e-instruct', label: 'Llama 4 Scout 17B', context: 131072, maxTokens: 8192, description: 'Meta Llama 4 Scout with 16 experts', badge: 'badge-preview', category: 'preview' },
            { value: 'moonshotai/kimi-k2-instruct', label: 'Kimi K2 Instruct', context: 131072, maxTokens: 16384, description: 'Moonshot AI Kimi K2 instruction model', badge: 'badge-preview', category: 'preview' },
            { value: 'qwen/qwen3-32b', label: 'Qwen 3 32B', context: 131072, maxTokens: 40960, description: 'Alibaba Cloud Qwen 3 32B model', badge: 'badge-preview', category: 'preview' }
        ];
        const openaiModels = [
            { value: 'gpt-4o', label: 'GPT-4o', context: 128000, maxTokens: 4096, description: 'Latest multimodal flagship model', badge: 'badge-new', category: 'production' },
            { value: 'gpt-4o-mini', label: 'GPT-4o Mini', context: 128000, maxTokens: 16384, description: 'Smaller, faster version of GPT-4o', badge: 'badge-new', category: 'production' },
            { value: 'gpt-4-turbo', label: 'GPT-4 Turbo', context: 128000, maxTokens: 4096, description: 'Previous flagship model with knowledge up to April 2024', badge: 'badge-updated', category: 'production' },
            { value: 'gpt-3.5-turbo', label: 'GPT-3.5 Turbo', context: 16385, maxTokens: 4096, description: 'Fast and capable model for most tasks', badge: 'badge-updated', category: 'production' },
            { value: 'o1', label: 'O1', context: 128000, maxTokens: 32768, description: 'Advanced reasoning model', badge: 'badge-new', category: 'production' },
            { value: 'o3', label: 'O3', context: 128000, maxTokens: 65536, description: 'Enhanced reasoning model', badge: 'badge-new', category: 'production' },
            { value: 'o4-mini', label: 'O4 Mini', context: 128000, maxTokens: 65536, description: 'Compact reasoning model', badge: 'badge-new', category: 'production' }
        ];
        const xaiModels = [
            { value: 'grok-beta', label: 'Grok Beta', context: 131072, maxTokens: 4096, description: 'Latest Grok model with real-time knowledge', badge: 'badge-new', category: 'production' },
            { value: 'grok-vision-beta', label: 'Grok Vision Beta', context: 131072, maxTokens: 4096, description: 'Multimodal Grok model with image understanding', badge: 'badge-new', category: 'production' }
        ];
        const anthropicModels = [
            { value: 'claude-3-5-sonnet-20241022', label: 'Claude 3.5 Sonnet', context: 200000, maxTokens: 8192, description: 'Most balanced model for speed and intelligence', badge: 'badge-new', category: 'production' },
            { value: 'claude-3-5-haiku-20241022', label: 'Claude 3.5 Haiku', context: 200000, maxTokens: 8192, description: 'Fastest and most compact model', badge: 'badge-new', category: 'production' },
            { value: 'claude-3-opus-20240229', label: 'Claude 3 Opus', context: 200000, maxTokens: 4096, description: 'Most powerful model for complex tasks', badge: 'badge-updated', category: 'production' },
            { value: 'claude-3-haiku-20240307', label: 'Claude 3 Haiku', context: 200000, maxTokens: 4096, description: 'Fast and compact model', badge: 'badge-updated', category: 'production' }
        ];
        
        // State
        let chats = JSON.parse(localStorage.getItem('aiChats')) || [];
        let currentChatId = localStorage.getItem('currentChatId') || null;
        let groqApiKey = localStorage.getItem('groqApiKey') || '';
        let openaiApiKey = localStorage.getItem('openaiApiKey') || '';
        let xaiApiKey = localStorage.getItem('xaiApiKey') || '';
        let anthropicApiKey = localStorage.getItem('anthropicApiKey') || '';
        let currentProvider = localStorage.getItem('currentProvider') || 'groq';
        let isTyping = false;
        let uploadedFiles = [];
        let transcriptionResults = [];
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set API key status
            updateApiKeyStatus();
            
            // Set current provider
            updateProviderUI();
            
            // Load current chat or create new one
            if (currentChatId && chats.find(chat => chat.id === currentChatId)) {
                loadChat(currentChatId);
            } else {
                createNewChat();
            }
            
            // Render chat list
            renderChatList();
            
            // Check for dark mode preference
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            }
            
            // Populate models based on current provider
            updateModelOptions();
            
            // Initialize transcription
            initializeTranscription();
        });
        
        // Event Listeners - FIXED: Changed provider tabs to call switchTab instead of switchProvider
        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keydown', handleKeyDown);
        newChatBtn.addEventListener('click', createNewChat);
        clearChatBtn.addEventListener('click', clearChat);
        settingsBtn.addEventListener('click', () => settingsModal.classList.remove('hidden'));
        closeSettingsBtn.addEventListener('click', () => settingsModal.classList.add('hidden'));
        saveSettingsBtn.addEventListener('click', saveSettings);
        darkModeToggle.addEventListener('click', toggleDarkMode);
        
        // Provider tabs - FIXED: Changed from switchProvider to switchTab
        groqTab.addEventListener('click', () => switchTab('groq'));
        openaiTab.addEventListener('click', () => switchTab('openai'));
        xaiTab.addEventListener('click', () => switchTab('xai'));
        anthropicTab.addEventListener('click', () => switchTab('anthropic'));
        transcriptionTab.addEventListener('click', () => switchTab('transcription'));
        
        // Model selection
        modelSelect.addEventListener('change', updateModelInfo);
        
        // Functions
        function clearChat() {
            if (currentChatId) {
                const chat = chats.find(c => c.id === currentChatId);
                if (chat) {
                    chat.messages = [];
                    saveChats();
                    renderMessages();
                }
            }
        }
        
        function switchProvider(provider) {
            currentProvider = provider;
            localStorage.setItem('currentProvider', provider);
            updateProviderUI();
            updateModelOptions();
        }
        
        function switchTab(tab) {
            if (tab === 'transcription') {
                // Hide chat elements
                chatModelSelection.classList.remove('active');
                chatContainer.classList.remove('active');
                chatInputArea.classList.remove('active');
                
                // Show transcription elements
                transcriptionOptionsPanel.classList.add('active');
                transcriptionContainer.classList.add('active');
                
                // Update tab active state
                document.querySelectorAll('.provider-tab').forEach(t => t.classList.remove('active'));
                transcriptionTab.classList.add('active');
            } else {
                // Show chat elements
                chatModelSelection.classList.add('active');
                chatContainer.classList.add('active');
                chatInputArea.classList.add('active');
                
                // Hide transcription elements
                transcriptionOptionsPanel.classList.remove('active');
                transcriptionContainer.classList.remove('active');
                
                // Update tab active state
                document.querySelectorAll('.provider-tab').forEach(t => t.classList.remove('active'));
                document.getElementById(`${tab}-tab`).classList.add('active');
                
                // Switch to the provider
                switchProvider(tab);
            }
        }
        
        function updateModelInfo() {
            const selectedModel = modelSelect.value;
            let modelInfoText = '';
            
            if (currentProvider === 'groq') {
                const model = groqModels.find(m => m.value === selectedModel);
                if (model) {
                    modelInfoText = `Context: ${model.context.toLocaleString()} tokens`;
                }
            } else if (currentProvider === 'openai') {
                const model = openaiModels.find(m => m.value === selectedModel);
                if (model) {
                    modelInfoText = `Context: ${model.context.toLocaleString()} tokens`;
                }
            } else if (currentProvider === 'xai') {
                const model = xaiModels.find(m => m.value === selectedModel);
                if (model) {
                    modelInfoText = `Context: ${model.context.toLocaleString()} tokens`;
                }
            } else if (currentProvider === 'anthropic') {
                const model = anthropicModels.find(m => m.value === selectedModel);
                if (model) {
                    modelInfoText = `Context: ${model.context.toLocaleString()} tokens`;
                }
            }
            
            modelInfo.textContent = modelInfoText;
        }
        
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            
            if (isDarkMode) {
                darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }
        
        function saveSettings() {
            groqApiKey = groqApiKeyInput.value;
            openaiApiKey = openaiApiKeyInput.value;
            xaiApiKey = xaiApiKeyInput.value;
            anthropicApiKey = anthropicApiKeyInput.value;
            
            localStorage.setItem('groqApiKey', groqApiKey);
            localStorage.setItem('openaiApiKey', openaiApiKey);
            localStorage.setItem('xaiApiKey', xaiApiKey);
            localStorage.setItem('anthropicApiKey', anthropicApiKey);
            
            updateApiKeyStatus();
            settingsModal.classList.add('hidden');
            
            showNotification('Settings saved successfully!', 'success');
        }
        
        function updateApiKeyStatus() {
            let hasApiKey = false;
            
            if (currentProvider === 'groq' && groqApiKey) {
                hasApiKey = true;
            } else if (currentProvider === 'openai' && openaiApiKey) {
                hasApiKey = true;
            } else if (currentProvider === 'xai' && xaiApiKey) {
                hasApiKey = true;
            } else if (currentProvider === 'anthropic' && anthropicApiKey) {
                hasApiKey = true;
            }
            
            apiKeyStatus.textContent = hasApiKey ? 'Set' : 'Not Set';
            apiKeyStatus.className = hasApiKey ? 'text-green-600' : 'text-red-600';
        }
        
        function updateProviderUI() {
            currentProviderSpan.textContent = currentProvider.charAt(0).toUpperCase() + currentProvider.slice(1);
            updateApiKeyStatus();
            
            // Update active tab
            document.querySelectorAll('.provider-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (currentProvider === 'groq') {
                groqTab.classList.add('active');
            } else if (currentProvider === 'openai') {
                openaiTab.classList.add('active');
            } else if (currentProvider === 'xai') {
                xaiTab.classList.add('active');
            } else if (currentProvider === 'anthropic') {
                anthropicTab.classList.add('active');
            }
        }
        
        function updateModelOptions() {
            modelSelect.innerHTML = '';
            
            let models = [];
            if (currentProvider === 'groq') {
                models = groqModels;
            } else if (currentProvider === 'openai') {
                models = openaiModels;
            } else if (currentProvider === 'xai') {
                models = xaiModels;
            } else if (currentProvider === 'anthropic') {
                models = anthropicModels;
            }
            
            models.forEach(model => {
                const option = document.createElement('option');
                option.value = model.value;
                option.textContent = model.label;
                modelSelect.appendChild(option);
            });
            
            updateModelInfo();
        }
        
        function createNewChat() {
            const newChat = {
                id: Date.now().toString(),
                title: 'New Chat',
                messages: [],
                provider: currentProvider,
                model: modelSelect.value,
                bookmarked: false,
                timestamp: new Date().toISOString()
            };
            
            chats.unshift(newChat);
            currentChatId = newChat.id;
            
            saveChats();
            loadChat(currentChatId);
            renderChatList();
            
            // Clear input
            messageInput.value = '';
        }
        
        function loadChat(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (!chat) return;
            
            currentChatId = chatId;
            localStorage.setItem('currentChatId', chatId);
            
            // Set provider and model
            if (chat.provider) {
                switchProvider(chat.provider);
                modelSelect.value = chat.model || modelSelect.options[0].value;
            }
            
            renderMessages();
            renderChatList();
        }
        
        function saveChats() {
            localStorage.setItem('aiChats', JSON.stringify(chats));
        }
        
        function renderMessages() {
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat) return;
            
            chatMessages.innerHTML = '';
            
            if (chat.messages.length === 0) {
                // Show welcome message
                chatMessages.innerHTML = `
                    <div class="text-center py-10">
                        <i class="fas fa-robot text-5xl text-indigo-500 mb-4"></i>
                        <h2 class="text-2xl font-bold text-gray-800 mb-2">Welcome to AI Chat</h2>
                        <p class="text-gray-600">Start a conversation with the latest AI models from Groq, OpenAI, x.ai, and Anthropic. Select a provider and model to begin!</p>
                    </div>
                `;
                return;
            }
            
            chat.messages.forEach(message => {
                const messageEl = document.createElement('div');
                messageEl.className = `flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`;
                
                const content = `
                    <div class="message ${message.role === 'user' ? 'bg-indigo-100 text-gray-800' : 'bg-white text-gray-800'} rounded-lg p-4 shadow">
                        <div class="font-semibold mb-1">${message.role === 'user' ? 'You' : 'AI'}</div>
                        <div class="message-content">${formatMessageContent(message.content)}</div>
                        ${message.webSearch ? renderWebSearchResults(message.webSearch) : ''}
                    </div>
                `;
                
                messageEl.innerHTML = content;
                chatMessages.appendChild(messageEl);
            });
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Table formatting functions
        function convertMarkdownTables(markdown) {
            const lines = markdown.split('\n');
            let result = [];
            let i = 0;
            
            while (i < lines.length) {
                // Check if current line is a table header
                if (lines[i].startsWith('|') && lines[i].endsWith('|') && lines[i].split('|').length >= 3) {
                    // Check next line is a separator
                    if (i + 1 < lines.length && isTableSeparator(lines[i+1])) {
                        // We have a table, collect all consecutive table rows
                        let tableLines = [lines[i]]; // header
                        i += 2; // skip header and separator
                        while (i < lines.length && isTableRow(lines[i])) {
                            tableLines.push(lines[i]);
                            i++;
                        }
                        // Convert the tableLines to HTML table
                        result.push(convertTableLinesToHTML(tableLines));
                        continue;
                    }
                }
                // Not a table, just add the line
                result.push(lines[i]);
                i++;
            }
            
            return result.join('\n');
        }
        
        function isTableSeparator(line) {
            // A separator line consists of |, -, :, and spaces
            // Example: |----------|----------|
            return line.startsWith('|') && line.endsWith('|') && 
                   /^[\|\s\-\:]+$/.test(line.replace(/\s/g, ''));
        }
        
        function isTableRow(line) {
            return line.startsWith('|') && line.endsWith('|') && line.split('|').length >= 3;
        }
        
        function convertTableLinesToHTML(lines) {
            if (lines.length === 0) return '';
            
            // First line is header
            const headerCells = lines[0].split('|').slice(1, -1).map(cell => cell.trim());
            const rows = lines.slice(1).map(line => 
                line.split('|').slice(1, -1).map(cell => cell.trim())
            );
            
            let html = '<table>';
            // Header
            html += '<thead><tr>';
            headerCells.forEach(cell => {
                html += `<th>${escapeHtml(cell)}</th>`;
            });
            html += '</tr></thead>';
            
            // Body
            html += '<tbody>';
            rows.forEach(row => {
                html += '<tr>';
                row.forEach(cell => {
                    html += `<td>${escapeHtml(cell)}</td>`;
                });
                html += '</tr>';
            });
            html += '</tbody></table>';
            
            return html;
        }
        
        function formatMessageContent(content) {
            // First, process code blocks
            content = content.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, language, code) => {
                const lang = language || 'text';
                return `<pre><code class="language-${lang}">${escapeHtml(code.trim())}</code></pre>`;
            });
            
            // Then, process tables
            content = convertMarkdownTables(content);
            
            // Then, process other markdown
            content = content.replace(/`([^`]+)`/g, '<code>$1</code>');
            content = content.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            content = content.replace(/\*(.*?)\*/g, '<em>$1</em>');
            content = content.replace(/^### (.*$)/gm, '<h3>$1</h3>');
            content = content.replace(/^## (.*$)/gm, '<h2>$1</h2>');
            content = content.replace(/^# (.*$)/gm, '<h1>$1</h1>');
            content = content.replace(/\n\n/g, '</p><p>');
            content = content.replace(/\n/g, '<br>');
            content = `<p>${content}</p>`;
            
            return content;
        }
        
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            
            return text.replace(/[&<>"']/g, m => map[m]);
        }
        
        function renderWebSearchResults(results) {
            if (!results || results.length === 0) return '';
            
            let html = `
                <div class="web-search-results mt-3">
                    <div class="web-search-title">
                        <i class="fas fa-search mr-2"></i> Web Search Results
                    </div>
            `;
            
            results.forEach(result => {
                html += `
                    <div class="web-search-result">
                        <div class="web-search-result-title">${result.title}</div>
                        <div class="web-search-result-snippet">${result.snippet}</div>
                        <a href="${result.link}" target="_blank" class="web-search-result-link">${result.link}</a>
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }
        
        function renderChatList() {
            // Clear containers
            bookmarkedChatsContainer.innerHTML = '';
            recentChatsContainer.innerHTML = '';
            
            // Separate bookmarked and recent chats
            const bookmarkedChats = chats.filter(chat => chat.bookmarked);
            const recentChats = chats.filter(chat => !chat.bookmarked).slice(0, 10);
            
            // Render bookmarked chats
            if (bookmarkedChats.length === 0) {
                bookmarkedChatsContainer.innerHTML = '<div class="text-sm text-gray-500 px-2 py-1">No bookmarked chats</div>';
            } else {
                bookmarkedChats.forEach(chat => {
                    bookmarkedChatsContainer.appendChild(createChatListItem(chat, true));
                });
            }
            
            // Render recent chats
            if (recentChats.length === 0) {
                recentChatsContainer.innerHTML = '<div class="text-sm text-gray-500 px-2 py-1">No recent chats</div>';
            } else {
                recentChats.forEach(chat => {
                    recentChatsContainer.appendChild(createChatListItem(chat, false));
                });
            }
        }
        
        function createChatListItem(chat, isBookmarked) {
            const item = document.createElement('div');
            item.className = `flex items-center justify-between p-2 rounded-md hover:bg-gray-100 cursor-pointer ${chat.id === currentChatId ? 'bg-indigo-50' : ''}`;
            
            const title = chat.title || 'New Chat';
            const date = new Date(chat.timestamp).toLocaleDateString();
            
            item.innerHTML = `
                <div class="flex items-center truncate" onclick="loadChat('${chat.id}')">
                    <i class="fas fa-${isBookmarked ? 'bookmark bookmark-active' : 'comment'} mr-2"></i>
                    <span class="truncate">${title}</span>
                </div>
                <div class="flex items-center space-x-1">
                    <button class="text-gray-500 hover:text-indigo-600 p-1" onclick="toggleBookmark('${chat.id}')">
                        <i class="fas fa-${chat.bookmarked ? 'bookmark bookmark-active' : 'bookmark'}"></i>
                    </button>
                    <button class="text-gray-500 hover:text-red-600 p-1" onclick="deleteChat('${chat.id}')">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            `;
            
            return item;
        }
        
        function toggleBookmark(chatId) {
            const chat = chats.find(c => c.id === chatId);
            if (chat) {
                chat.bookmarked = !chat.bookmarked;
                saveChats();
                renderChatList();
            }
        }
        
        function deleteChat(chatId) {
            if (confirm('Are you sure you want to delete this chat?')) {
                chats = chats.filter(c => c.id !== chatId);
                
                if (currentChatId === chatId) {
                    if (chats.length > 0) {
                        loadChat(chats[0].id);
                    } else {
                        createNewChat();
                    }
                }
                
                saveChats();
                renderChatList();
            }
        }
        
        function handleKeyDown(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }
        
        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat) return;
            
            // Add user message
            chat.messages.push({
                role: 'user',
                content: message,
                timestamp: new Date().toISOString()
            });
            
            // Update chat title if it's the first message
            if (chat.messages.length === 1) {
                chat.title = message.substring(0, 30) + (message.length > 30 ? '...' : '');
            }
            
            // Update provider and model
            chat.provider = currentProvider;
            chat.model = modelSelect.value;
            
            // Save and render
            saveChats();
            renderMessages();
            renderChatList();
            
            // Clear input
            messageInput.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Send to AI
            sendToAI(message);
        }
        
        function showTypingIndicator() {
            isTyping = true;
            const typingEl = document.createElement('div');
            typingEl.className = 'flex justify-start';
            typingEl.id = 'typing-indicator';
            
            typingEl.innerHTML = `
                <div class="message bg-white text-gray-800 rounded-lg p-4 shadow">
                    <div class="font-semibold mb-1">AI</div>
                    <div class="typing-indicator">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(typingEl);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function hideTypingIndicator() {
            isTyping = false;
            const typingEl = document.getElementById('typing-indicator');
            if (typingEl) {
                typingEl.remove();
            }
        }
        
        async function sendToAI(message) {
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat) return;
            
            let apiKey = '';
            let endpoint = '';
            let headers = {};
            let body = {};
            
            // Prepare request based on provider
            if (currentProvider === 'groq') {
                apiKey = groqApiKey;
                endpoint = 'https://api.groq.com/openai/v1/chat/completions';
                headers = {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                };
                
                body = {
                    model: modelSelect.value,
                    messages: chat.messages.map(m => ({ role: m.role, content: m.content })),
                    temperature: 0.7,
                    max_tokens: 4096
                };
                
                if (webSearchToggle.checked) {
                    body.tools = [{
                        type: "function",
                        function: {
                            name: "web_search",
                            description: "Search the web for current information",
                            parameters: {
                                type: "object",
                                properties: {
                                    query: {
                                        type: "string",
                                        description: "The search query to look up on the web"
                                    }
                                },
                                required: ["query"]
                            }
                        }
                    }];
                    body.tool_choice = "auto";
                }
            } else if (currentProvider === 'openai') {
                apiKey = openaiApiKey;
                endpoint = 'https://api.openai.com/v1/chat/completions';
                headers = {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                };
                
                body = {
                    model: modelSelect.value,
                    messages: chat.messages.map(m => ({ role: m.role, content: m.content })),
                    temperature: 0.7,
                    max_tokens: 4096
                };
            } else if (currentProvider === 'xai') {
                apiKey = xaiApiKey;
                endpoint = 'https://api.x.ai/v1/chat/completions';
                headers = {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                };
                
                body = {
                    model: modelSelect.value,
                    messages: chat.messages.map(m => ({ role: m.role, content: m.content })),
                    temperature: 0.7,
                    max_tokens: 4096
                };
            } else if (currentProvider === 'anthropic') {
                apiKey = anthropicApiKey;
                endpoint = 'https://api.anthropic.com/v1/messages';
                headers = {
                    'x-api-key': apiKey,
                    'Content-Type': 'application/json',
                    'anthropic-version': '2023-06-01'
                };
                
                // Convert messages to Anthropic format
                const anthropicMessages = [];
                let systemMessage = '';
                
                chat.messages.forEach(m => {
                    if (m.role === 'user') {
                        anthropicMessages.push({
                            role: 'user',
                            content: m.content
                        });
                    } else if (m.role === 'assistant') {
                        anthropicMessages.push({
                            role: 'assistant',
                            content: m.content
                        });
                    }
                });
                
                body = {
                    model: modelSelect.value,
                    max_tokens: 4096,
                    messages: anthropicMessages
                };
            }
            
            if (!apiKey) {
                hideTypingIndicator();
                showNotification(`Please set your ${currentProvider} API key in settings`, 'error');
                return;
            }
            
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(body)
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                
                const data = await response.json();
                let content = '';
                let webSearchResults = null;
                
                if (currentProvider === 'anthropic') {
                    content = data.content[0].text;
                } else {
                    content = data.choices[0].message.content;
                    
                    // Check for web search results
                    if (webSearchToggle.checked && data.choices[0].message.tool_calls) {
                        const toolCall = data.choices[0].message.tool_calls[0];
                        if (toolCall.function.name === 'web_search') {
                            const args = JSON.parse(toolCall.function.arguments);
                            webSearchResults = await performWebSearch(args.query);
                        }
                    }
                }
                
                // Add AI response
                chat.messages.push({
                    role: 'assistant',
                    content: content,
                    timestamp: new Date().toISOString(),
                    webSearch: webSearchResults
                });
                
                saveChats();
                renderMessages();
                renderChatList();
                
            } catch (error) {
                console.error('Error sending message to AI:', error);
                
                // Add error message
                chat.messages.push({
                    role: 'assistant',
                    content: `Sorry, I encountered an error: ${error.message}`,
                    timestamp: new Date().toISOString()
                });
                
                saveChats();
                renderMessages();
            } finally {
                hideTypingIndicator();
            }
        }
        
        async function performWebSearch(query) {
            // This is a mock function for web search
            // In a real implementation, you would use a web search API
            
            return [
                {
                    title: "Example Search Result 1",
                    snippet: "This is a sample search result snippet that would contain relevant information about the query.",
                    link: "https://example.com/result1"
                },
                {
                    title: "Example Search Result 2",
                    snippet: "Another sample search result that provides additional context for the user's query.",
                    link: "https://example.com/result2"
                }
            ];
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Transcription functions
        function initializeTranscription() {
            // File upload
            fileUploadArea.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            
            // Drag and drop
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.classList.add('dragover');
            });
            
            fileUploadArea.addEventListener('dragleave', () => {
                fileUploadArea.classList.remove('dragover');
            });
            
            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });
            
            // Buttons
            transcribeBtn.addEventListener('click', transcribeFiles);
            clearFilesBtn.addEventListener('click', clearFiles);
        }
        
        function handleFileSelect(e) {
            handleFiles(e.target.files);
        }
        
        function handleFiles(files) {
            if (files.length === 0) return;
            
            // Add files to the list
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Check if file is already in the list
                if (uploadedFiles.some(f => f.name === file.name && f.size === file.size)) {
                    continue;
                }
                
                uploadedFiles.push(file);
            }
            
            renderFileList();
            updateTranscribeButton();
        }
        
        function renderFileList() {
            fileList.innerHTML = '';
            
            if (uploadedFiles.length === 0) {
                fileList.style.display = 'none';
                clearFilesBtn.style.display = 'none';
                return;
            }
            
            fileList.style.display = 'block';
            clearFilesBtn.style.display = 'inline-block';
            
            uploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                const fileSize = formatFileSize(file.size);
                const fileIcon = getFileIcon(file.type);
                
                fileItem.innerHTML = `
                    <div class="file-info">
                        <i class="${fileIcon} text-indigo-500"></i>
                        <div>
                            <div class="file-name">${file.name}</div>
                            <div class="file-size">${fileSize}</div>
                        </div>
                    </div>
                    <div class="file-actions">
                        <button class="text-red-500 hover:text-red-700" onclick="removeFile(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                fileList.appendChild(fileItem);
            });
        }
        
        function removeFile(index) {
            uploadedFiles.splice(index, 1);
            renderFileList();
            updateTranscribeButton();
        }
        
        function clearFiles() {
            uploadedFiles = [];
            renderFileList();
            updateTranscribeButton();
        }
        
        function updateTranscribeButton() {
            transcribeBtn.disabled = uploadedFiles.length === 0;
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function getFileIcon(fileType) {
            if (fileType.startsWith('audio/')) {
                return 'fas fa-music';
            } else if (fileType.startsWith('video/')) {
                return 'fas fa-film';
            } else {
                return 'fas fa-file';
            }
        }
        
        async function transcribeFiles() {
            if (uploadedFiles.length === 0) return;
            
            if (!groqApiKey) {
                showNotification('Please set your Groq API key in settings', 'error');
                return;
            }
            
            transcribeBtn.disabled = true;
            transcribeBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Transcribing...';
            
            const results = [];
            
            for (let i = 0; i < uploadedFiles.length; i++) {
                const file = uploadedFiles[i];
                
                // Create progress element
                const progressEl = document.createElement('div');
                progressEl.className = 'transcription-container';
                progressEl.innerHTML = `
                    <div class="transcription-header">
                        <div class="transcription-title">
                            <i class="fas fa-file-audio mr-2"></i>
                            ${file.name}
                        </div>
                        <div class="transcription-actions">
                            <button class="text-sm text-gray-500 hover:text-gray-700">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div class="transcription-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">0%</div>
                    </div>
                `;
                
                transcriptionResultsContainer.appendChild(progressEl);
                
                try {
                    // Convert file to base64
                    const base64 = await fileToBase64(file);
                    
                    // Send to Groq API
                    const response = await fetch('https://api.groq.com/openai/v1/audio/transcriptions', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${groqApiKey}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            file: base64,
                            model: transcriptionModel.value,
                            language: transcriptionLanguage.value === 'auto' ? null : transcriptionLanguage.value,
                            response_format: 'verbose_json',
                            timestamp_granularities: timestampsCheckbox.checked ? ['word'] : []
                        })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Transcription failed: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    // Update progress
                    progressEl.querySelector('.progress-fill').style.width = '100%';
                    progressEl.querySelector('.progress-text').textContent = '100%';
                    
                    // Create transcription result
                    const result = {
                        filename: file.name,
                        text: data.text,
                        language: data.language,
                        duration: data.duration,
                        segments: data.segments
                    };
                    
                    results.push(result);
                    
                    // Update UI with transcription
                    setTimeout(() => {
                        progressEl.innerHTML = `
                            <div class="transcription-header">
                                <div class="transcription-title">
                                    <i class="fas fa-file-audio mr-2"></i>
                                    ${file.name}
                                </div>
                                <div class="transcription-actions">
                                    <button class="text-sm text-gray-500 hover:text-gray-700" onclick="downloadTranscription(${i})">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    ${addToChatCheckbox.checked ? `<button class="text-sm text-indigo-500 hover:text-indigo-700" onclick="addToChat(${i})">
                                        <i class="fas fa-comment-medical"></i>
                                    </button>` : ''}
                                </div>
                            </div>
                            <div class="transcription-text">${data.text}</div>
                            <div class="transcription-info">
                                Language: ${data.language} | Duration: ${formatDuration(data.duration)}
                            </div>
                        `;
                    }, 500);
                    
                } catch (error) {
                    console.error('Error transcribing file:', error);
                    
                    progressEl.innerHTML = `
                        <div class="transcription-header">
                            <div class="transcription-title text-red-500">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                ${file.name} - Error
                            </div>
                        </div>
                        <div class="transcription-text text-red-500">
                            ${error.message}
                        </div>
                    `;
                }
            }
            
            // Store results
            transcriptionResults = results;
            
            // Reset button
            transcribeBtn.disabled = false;
            transcribeBtn.innerHTML = '<i class="fas fa-magic mr-2"></i> Transcribe Files';
            
            // Show notification
            showNotification(`Transcription completed for ${results.length} file(s)`, 'success');
            
            // Download as ZIP if requested
            if (batchDownloadCheckbox.checked && results.length > 0) {
                downloadAllTranscriptions();
            }
        }
        
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
        
        function formatDuration(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        function downloadTranscription(index) {
            const result = transcriptionResults[index];
            if (!result) return;
            
            const blob = new Blob([result.text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${result.filename.replace(/\.[^/.]+$/, '')}_transcription.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function addToChat(index) {
            const result = transcriptionResults[index];
            if (!result) return;
            
            // Switch to chat tab
            switchTab('groq');
            
            // Add to current chat
            const chat = chats.find(c => c.id === currentChatId);
            if (!chat) return;
            
            // Add user message
            chat.messages.push({
                role: 'user',
                content: `Transcription of ${result.filename}:`,
                timestamp: new Date().toISOString()
            });
            
            // Add AI message with transcription
            chat.messages.push({
                role: 'assistant',
                content: result.text,
                timestamp: new Date().toISOString()
            });
            
            // Update chat title if it's the first message
            if (chat.messages.length === 2) {
                chat.title = `Transcription: ${result.filename.substring(0, 20)}${result.filename.length > 20 ? '...' : ''}`;
            }
            
            // Save and render
            saveChats();
            renderMessages();
            renderChatList();
            
            showNotification('Transcription added to chat', 'success');
        }
        
        async function downloadAllTranscriptions() {
            if (transcriptionResults.length === 0) return;
            
            const zip = new JSZip();
            
            transcriptionResults.forEach((result, index) => {
                const filename = `${result.filename.replace(/\.[^/.]+$/, '')}_transcription.txt`;
                zip.file(filename, result.text);
            });
            
            const content = await zip.generateAsync({ type: 'blob' });
            const url = URL.createObjectURL(content);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'transcriptions.zip';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
